---
sidebar: sidebar 
permalink: task-configuring-proxy.html 
keywords: proxy, proxy server, proxy, internet, HTTP, http, https 
summary: 社内ポリシーで、インターネットへのすべての通信にプロキシサーバを使用する必要がある場合は、そのプロキシサーバを使用するようにコネクタを設定する必要があります。インストール時にプロキシサーバを使用するようにコネクタを設定していない場合は、いつでもそのプロキシサーバを使用するようにコネクタを設定できます。 
---
= プロキシサーバを使用するようにコネクタを設定します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
社内ポリシーで、インターネットへのすべての通信にプロキシサーバを使用する必要がある場合は、そのプロキシサーバを使用するようにコネクタを設定する必要があります。インストール時にプロキシサーバを使用するようにコネクタを設定していない場合は、いつでもそのプロキシサーバを使用するようにコネクタを設定できます。

コネクタのプロキシ サーバーは、パブリック IP または NAT ゲートウェイなしでアウトバウンドのインターネット アクセスを可能にします。プロキシサーバーはコネクタのみにアウトバウンド接続を提供し、Cloud Volumes ONTAPシステムには提供しません。

Cloud Volumes ONTAPシステムにアウトバウンド インターネット アクセスがない場合、 BlueXP はコネクタのプロキシ サーバーを使用するようにシステムを構成します。コネクタのセキュリティ グループがポート 3128 経由の受信接続を許可していることを確認する必要があります。コネクタをデプロイした後、このポートを開きます。

コネクタ自体に送信インターネット接続がない場合、 Cloud Volumes ONTAPシステムは構成されたプロキシ サーバーを使用できません。



== サポートされている構成

* Cloud Volumes ONTAPシステムにサービスを提供するコネクタでは、透過プロキシサーバーがサポートされています。BlueXPBlueXPをCloud Volumes ONTAPで使用する場合は、透過プロキシサーバーを使用できるCloud Volumes ONTAP専用のコネクタを作成してください。
* 明示的なプロキシ サーバーは、 Cloud Volumes ONTAPシステムを管理するものやBlueXPサービスを管理するものなど、すべてのコネクタでサポートされています。
* HTTP と HTTPS。
* プロキシ サーバーはクラウドまたはネットワーク内に配置できます。



IMPORTANT: プロキシを設定したら、プロキシの種類を変更することはできません。プロキシの種類を変更する必要がある場合は、コネクタを削除し、新しいプロキシの種類で新しいコネクタを追加してください。



== コネクタで明示的なプロキシを有効にする

プロキシサーバ、そのコネクタ、および管理対象の Cloud Volumes ONTAP システム（ HA メディエーターを含む）を使用するようにコネクタを設定すると、すべてのでプロキシサーバが使用されます。

この操作によりコネクタが再起動されます。続行する前に、コネクタがアイドル状態であることを確認してください。

.手順
. [BlueXPコネクタの編集]*ページに移動します。
+
[role="tabbed-block"]
====
.標準モード
--
.. BlueXPヘッダーの* Connector *ドロップダウンを選択します。
.. [コネクタの管理]*を選択します。
+
image:screenshot-manage-connectors.png["コネクタの選択後に表示される[Manage Connectors]ページのスクリーンショット。"]

.. コネクターのアクションメニューを選択し、*コネクターを編集*を選択します。
+
image:screenshot-edit-connector-standard.png["アクションメニューから使用できる[Edit Connectors]オプションを示すスクリーンショット。"]



--
.制限モードまたはプライベートモード
--
.. BlueXPヘッダーの* Connector *ドロップダウンを選択します。
.. [Edit Connector]*を選択します。
+
image:screenshot-edit-connector.png["[Connector]メニューを展開すると使用できる[Edit Connector]オプションを示すスクリーンショット。"]



--
====
. [HTTP Proxy Configuration]*を選択します。
. 構成タイプ フィールドで *明示的なプロキシ* を選択します。
. [Enable Proxy]*を選択します。
. 構文を使用してサーバを指定します http://_address:port_[] または https://_address:port_[]
. サーバでベーシック認証が必要な場合は、ユーザ名とパスワードを指定します。
+
次の点に注意してください。

+
** ユーザには、ローカルユーザまたはドメインユーザを指定できます。
** ドメインユーザの場合は、\のASCIIコードを次のように入力する必要があります。domain-name%92user-name
+
例：NetApp%92proxy

** BlueXPでは、@文字を含むパスワードはサポートされていません。


. [ 保存（ Save ） ] を選択します。




== コネクタで透過プロキシを有効にする

Cloud Volumes ONTAPのみがコネクタ上で透過プロキシの使用をサポートしています。CloudCloud Volumes ONTAPに加えてBlueXPサービスを使用する場合は、データサービス用またはCloud Volumes ONTAP用として別のコネクタを作成する必要があります。

透過プロキシを有効にする前に、次の要件が満たされていることを確認してください。

* コネクタは、透過プロキシ サーバーと同じネットワークにインストールされます。
* プロキシ サーバーで TLS 検査が有効になっています。
* 透過プロキシ サーバーで使用されている証明書と一致する PEM 形式の証明書があります。
* Cloud Volumes ONTAP以外のNetAppデータ サービスにはコネクタを使用しないでください。


既存のコネクタを透過プロキシ サーバーを使用するように構成するには、コネクタ ホストのコマンド ラインから使用できるコネクタ メンテナンス ツールを使用します。

プロキシサーバーを設定すると、コネクタが再起動します。続行する前に、コネクタがアイドル状態であることを確認してください。

.手順
+ プロキシサーバーのPEM形式の証明書ファイルがあることを確認してください。証明書がない場合は、ネットワーク管理者に問い合わせて取得してください。

. コネクタ ホストでコマンド ライン インターフェイスを開きます。
. コネクタメンテナンスツールディレクトリに移動します。  `/opt/application/netapp/service-manager-2/connector-maint-console`
. 透過プロキシを有効にするには、次のコマンドを実行します。  `/home/ubuntu/<certificate-file>.pem`プロキシ サーバーのディレクトリと証明書ファイルの名前です。
+
[source, CLI]
----
./connector-maint-console proxy add -c /home/ubuntu/<certificate-file>.pem
----
+
証明書ファイルが PEM 形式であり、コマンドと同じディレクトリに存在することを確認するか、証明書ファイルへのフルパスを指定します。

+
[source, CLI]
----
./connector-maint-console proxy add -c /home/ubuntu/<certificate-file>.pem
----




=== コネクタの透過プロキシを変更する

コネクタの既存の透過プロキシサーバーを更新するには、  `proxy update`コマンドを使用して透過プロキシサーバーを削除するか、  `proxy remove`コマンド。詳細については、 link:reference-connector-maint-console.html["コネクタメンテナンスコンソール"] 。


IMPORTANT: プロキシを設定したら、プロキシの種類を変更することはできません。プロキシの種類を変更する必要がある場合は、コネクタを削除し、新しいプロキシの種類で新しいコネクタを追加してください。



== インターネットへのアクセスが失われた場合はコネクタプロキシを更新します

ネットワークのプロキシ設定が変更されると、コネクタがインターネットにアクセスできなくなる可能性があります。例えば、誰かがプロキシサーバーのパスワードを変更したり、証明書を更新したりした場合などです。この場合、コネクタホストから直接UIにアクセスし、設定を更新する必要があります。コネクタホストへのネットワークアクセスがあり、 BlueXP UIにログインできることを確認してください。



== API の直接トラフィックを有効にします

プロキシサーバを使用するようにコネクタを設定した場合は、コネクタで直接APIトラフィックを有効にして、プロキシを経由せずにAPI呼び出しをクラウドプロバイダサービスに直接送信できます。AWS、Azure、または Google Cloud で実行されているコネクタはこのオプションをサポートします。

Cloud Volumes ONTAP を使用して Azure Private Links を無効にし、サービス エンドポイントを使用する場合は、直接 API トラフィックを有効にします。そうしないと、トラフィックは適切にルーティングされません。

https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-enabling-private-link.html["Azure Private LinkまたはサービスエンドポイントをCloud Volumes ONTAP で使用する方法の詳細については、こちらをご覧ください"^]

.手順
. [BlueXPコネクタの編集]*ページに移動します。
+
ナビゲーションはBlueXPのモードによって異なります。標準モードでは、SaaSウェブサイトからインターフェースにアクセスします。制限モードまたはプライベートモードでは、コネクタホストからローカルにアクセスします。

+
[role="tabbed-block"]
====
.標準モード
--
.. BlueXPヘッダーの* Connector *ドロップダウンを選択します。
.. [コネクタの管理]*を選択します。
+
image:screenshot-manage-connectors.png["コネクタの選択後に表示される[Manage Connectors]ページのスクリーンショット。"]

.. コネクターのアクションメニューを選択し、*コネクターを編集*を選択します。
+
image:screenshot-edit-connector-standard.png["アクションメニューから使用できる[Edit Connectors]オプションを示すスクリーンショット。"]



--
.制限モードまたはプライベートモード
--
.. BlueXPヘッダーの* Connector *ドロップダウンを選択します。
.. [Edit Connector]*を選択します。
+
image:screenshot-edit-connector.png["[Connector]メニューを展開すると使用できる[Edit Connector]オプションを示すスクリーンショット。"]



--
====
. [サポート][Direct API Traffic]*を選択します。
. チェックボックスをオンにしてオプションを有効にし、*[保存]*を選択します。

