---
sidebar: sidebar 
permalink: task-install-connector-azure.html 
keywords: install connector, azure connector installation, azure connector, install connector in azure, bluexp, azure marketplace, manual install, create connector 
summary: コネクタは、BlueXPのWebベースのコンソールやAzure Marketplaceから直接作成するか、自社のLinuxホストにインストールして作成します。 
---
= Azure でコネクタを作成します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
コネクタは、BlueXPのWebベースのコンソールやAzure Marketplaceから直接作成するか、自社のLinuxホストにインストールして作成します。

[role="tabbed-block"]
====
.BlueXP
--
.必要なもの
* Azure サブスクリプション。
* 選択した Azure リージョン内の VNet およびサブネット
* すべての発信インターネットトラフィックにプロキシを必要とする場合は、プロキシサーバの詳細を参照してください。
+
** IP アドレス
** クレデンシャル
** HTTPS証明書


* BlueXPでコネクタ用のAzureロールを自動的に作成しない場合は、自分で作成する必要があります link:reference-permissions-azure.html["このページのポリシーを使用する"]。
+
これらの権限はコネクタインスタンス自体に適用されます。これは、以前にコネクタを展開するように設定したアクセス権とは異なります。



.手順
. 最初の作業環境を作成する場合は、 * 作業環境の追加 * をクリックし、プロンプトに従います。それ以外の場合は、 [*connector*] ドロップダウンをクリックし、 [*Add connector*] を選択します。
+
image:screenshot_connector_add.gif["ヘッダーのコネクターアイコンとコネクターの追加アクションを示すスクリーンショット。"]

. クラウドプロバイダとして「 * Microsoft Azure * 」を選択します。
. [*コネクターの配置（Deploying a Connector *）]ページ：
+
.. [認証]*で、Azure権限の設定方法に一致する認証オプションを選択します。
+
*** Azureユーザーアカウント*を選択して、必要な権限があるMicrosoftアカウントにログインします。
+
このフォームは、 Microsoft が所有およびホストしています。クレデンシャルがネットアップに提供されていません。

+

TIP: すでにAzureアカウントにログインしている場合は、BlueXPによって自動的にそのアカウントが使用されます。アカウントが複数ある場合は、適切なアカウントを使用するために、最初にログアウトする必要があります。

*** [Active Directory service principal]*を選択して、必要な権限を付与するAzure Active Directoryサービスプリンシパルに関する情報を入力します。
+
**** アプリケーション（クライアント）ID
**** ディレクトリ（テナント）ID
**** クライアントシークレット






+
link:task-set-up-permissions-azure.html["サービスプリンシパルのこれらの値を取得する方法について説明します"]。

. ウィザードの手順に従って、コネクタを作成します。
+
** * VM 認証 * ： Azure サブスクリプション、場所、新しいリソースグループ、または既存のリソースグループを選択し、認証方法を選択します。
** *詳細*:インスタンスの名前を入力し、タグを指定して、必要な権限を持つ新しいロールを作成するか、またはで設定した既存のロールを選択するかを選択します link:reference-permissions-azure.html["必要な権限"]。
+
このロールに関連付けられているサブスクリプションを選択できます。選択した各サブスクリプションには、 Cloud Volumes ONTAP をこれらのサブスクリプションに導入するための権限が Connector に付与されます。

** * ネットワーク * ： VNet とサブネットを選択し、パブリック IP アドレスを有効にするかどうか、および必要に応じてプロキシ設定を指定します。
** * セキュリティグループ * ：新しいセキュリティグループを作成するか、インバウンド HTTP 、 HTTPS 、 SSH アクセスを許可する既存のセキュリティグループを選択するかを選択します。
** * 復習 * ：選択内容を確認して、設定が正しいことを確認してください。


. [ 追加（ Add ） ] をクリックします。
+
仮想マシンの準備が完了するまでに約 7 分かかります。処理が完了するまで、ページには表示されたままにしておいてください。



.結果
プロセスが完了すると、BlueXPからコネクタを使用できるようになります。

--
.Azure Marketplace で入手できます
--
.手順
. Azure MarketplaceのNetApp Connector VMのページに移動します。
+
https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["Azure Marketplaceの一般企業向けページ"^]

. [* Get it Now* ( 今すぐ取得 )] をクリックし、 [* Continue * ( 続行 )] をクリックします。
. Azure ポータルで、 * Create * をクリックし、手順に従って仮想マシンを設定します。
+
VM を設定する際には、次の点に注意してください。

+
** コネクタはHDDディスクまたはSSDディスクで最適に動作します。
** CPU と RAM の要件を満たす VM サイズを選択します。DS3 v2 を推奨します。
+
link:reference-host-requirements-azure["VM の要件を確認します"]。

** ネットワークセキュリティグループの場合、コネクタには、 SSH 、 HTTP 、および HTTPS を使用したインバウンド接続が必要です。
+
link:reference-ports-azure.html["コネクタのセキュリティグループルールの詳細については、こちらを参照してください"]。

** [Management]*で、[On]*を選択して、コネクターVMの*[System assigned managed identity]*を有効にします。
+
管理対象の ID を使用すると、 Connector 仮想マシンはクレデンシャルを指定せずに自身を Azure Active Directory に識別できるため、この設定は重要です。完了したら、作成したカスタムロールを割り当てる必要があります https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["Azure リソース用の管理対象 ID の詳細については、こちらをご覧ください"^]。



. [* Review + create * （レビュー + 作成） ] ページで選択内容を確認し、 [* Create * （作成） ] をクリックして展開を開始します。
+
指定した設定で仮想マシンが展開されます。仮想マシンと Connector ソフトウェアが起動するまでの所要時間は約 5 分です。

. Connector 仮想マシンに接続されているホストから Web ブラウザを開き、次の URL を入力します。
+
https://_ipaddress_[]

. ログイン後、コネクタを設定します。
+
.. コネクタに関連付けるBlueXPアカウントを指定します。
.. システムの名前を入力します。
.. *では、セキュリティ保護された環境で実行していますか？*制限モードを無効にしたままにします。
+
標準モードでBlueXPを使用する手順について説明しているため、制限モードは無効にしておく必要があります。セキュアな環境でBlueXPバックエンドサービスからこのアカウントを切断する場合にのみ、制限モードを有効にしてください。その場合は、 link:task-quick-start-restricted-mode.html["制限モードでBlueXPの使用を開始するには、次の手順に従います"]。

.. [Let's start]*をクリックします。




これでコネクタがインストールされ、BlueXPアカウントでセットアップされました。

.次の手順
link:task-provide-permissions-azure.html["以前に設定した権限をBlueXPに付与します"]。

--
.手動インストール
--
.必要なもの
* コネクタをインストールするためのroot権限。
* コネクタからのインターネットアクセスにプロキシが必要な場合は、プロキシサーバに関する詳細。
+
インストール後にプロキシサーバを設定することもできますが、その場合はコネクタを再起動する必要があります。

* プロキシサーバがHTTPSを使用している場合、またはプロキシが代行受信プロキシの場合は、CA署名証明書。
* カスタムロールを使用して必要なAzure権限を指定できるように、AzureのVMで有効になっている管理対象ID。
+
https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm["Microsoft Azureのドキュメント：Azureポータルを使用して、VM上のAzureリソースの管理IDを設定します"^]



.このタスクについて
* インストールを実行すると、ネットアップサポートからのリカバリ手順用に AWS コマンドラインツール（ awscli ）がインストールされます。
+
AWSCLI のインストールに失敗したというメッセージが表示された場合は、このメッセージを無視しても問題ありません。コネクタは、工具なしで正常に作動する。

* ネットアップサポートサイトで入手できるインストーラは、それよりも古いバージョンの場合があります。インストール後、新しいバージョンが利用可能になると、コネクタは自動的に更新されます。


.手順
. Docker が有効で実行されていることを確認します。
+
[source, cli]
----
sudo systemctl enable docker && sudo systemctl start docker
----
. ホストに_http_proxy_or_https_proxy_system変数が設定されている場合は、削除します。
+
[source, cli]
----
unset http_proxy
unset https_proxy
----
+
これらのシステム変数を削除しないと、インストールは失敗します。

. からConnectorソフトウェアをダウンロードします https://mysupport.netapp.com/site/products/all/details/cloud-manager/downloads-tab["ネットアップサポートサイト"^]をクリックし、 Linux ホストにコピーします。
+
ネットワークまたはクラウドで使用するための「オンライン」コネクタインストーラをダウンロードする必要があります。コネクタには別の「オフライン」インストーラが用意されていますが、プライベートモード展開でのみサポートされています。

. スクリプトを実行する権限を割り当てます。
+
[source, cli]
----
chmod +x OnCommandCloudManager-<version>
----
+
<version> は、ダウンロードしたコネクタのバージョンです。

. インストールスクリプトを実行します。
+
[source, cli]
----
 ./OnCommandCloudManager-<version> --proxy <HTTP or HTTPS proxy server> --cacert <path and file name of a CA-signed certificate>
----
+
--proxyパラメータと--cacert.pemパラメータはオプションです。プロキシサーバがある場合は、次のようにパラメータを入力する必要があります。プロキシに関する情報の入力を求めるプロンプトは表示されません。

+
次に、両方のオプションパラメータを使用したコマンドの例を示します。

+
[source, cli]
----
 ./OnCommandCloudManager-V3.9.26 --proxy https://user:password@10.0.0.30:8080/ --cacert /tmp/cacert/certificate.cer
----
+
--proxyは、次のいずれかの形式を使用してHTTPまたはHTTPSプロキシサーバを使用するようにコネクタを設定します。

+
** \ http://address:port
** \ http://username:password@address:port
** \ https://address:port
** \ https://username:password@address:port


+
--cacertsは、コネクタとプロキシサーバ間のHTTPSアクセスに使用するCA署名証明書を指定しています。このパラメータは、HTTPSプロキシサーバを指定する場合、または代行受信プロキシを指定する場合にのみ必要です。

. インストールが完了するまで待ちます。
+
プロキシサーバを指定した場合は、インストールの終了時にConnectorサービス（occm）が2回再起動されます。

. Connector 仮想マシンに接続されているホストから Web ブラウザを開き、次の URL を入力します。
+
https://_ipaddress_[]

. ログイン後、コネクタを設定します。
+
.. コネクタに関連付けるBlueXPアカウントを指定します。
.. システムの名前を入力します。
.. *では、セキュリティ保護された環境で実行していますか？*制限モードを無効にしたままにします。
+
標準モードでBlueXPを使用する手順について説明しているため、制限モードは無効にしておく必要があります。セキュアな環境でBlueXPバックエンドサービスからこのアカウントを切断する場合にのみ、制限モードを有効にしてください。その場合は、 link:task-quick-start-restricted-mode.html["制限モードでBlueXPの使用を開始するには、次の手順に従います"]。

.. [Let's start]*をクリックします。




.結果
これでコネクタがインストールされ、BlueXPアカウントでセットアップされました。

.次の手順
link:task-provide-permissions-azure.html["以前に設定した権限をBlueXPに付与します"]。

--
====