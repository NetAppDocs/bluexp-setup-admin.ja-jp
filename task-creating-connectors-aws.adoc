---
sidebar: sidebar 
permalink: task-creating-connectors-aws.html 
keywords: fsx for ontap, iam, user role, create connector in aws, launch connector in aws, deploy connector in aws, aws connector, connector aws, connector permissions 
summary: BlueXPのほとんどの機能を使用するには、コネクタを展開する必要があります。Connectorを使用すると、BlueXPはパブリッククラウド環境内のリソースとプロセスを管理できます。 
---
= BlueXPからAWSにコネクタを作成します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
BlueXPのほとんどの機能を使用するには'BlueXPアカウント管理者が_Connector_を 配備する必要がありますConnectorを使用すると、BlueXPはパブリッククラウド環境内のリソースとプロセスを管理できます。 link:concept-connectors.html["コネクタが必要になるタイミングを学習します"]。

このページでは、BlueXPからAWSでコネクタを直接作成する方法について説明します。 link:concept-connectors.html#how-to-create-a-connector["コネクタを配置するその他の方法について説明します"]。

これらの手順は、 Account Admin ロールを持つユーザが実行する必要があります。ワークスペース管理者はコネクタを作成できません。



== クイックスタート

これらの手順を実行すると、すぐに作業を開始できます。また、残りのセクションまでスクロールして詳細を確認することもできます。

[role="quick-margin-para"]
AWSでコネクタを起動するには、IAMロールまたはAWSアクセスキーを使用して、BlueXPがAWSで認証する必要があります。どちらのオプションでも、IAMポリシーが必要です。

[role="quick-margin-para"]
 an IAM policy,IAMロールを確認します または  up AWS authentication,ステップバイステップの手順に従います。

[role="quick-margin-para"]
特定のエンドポイントへのアウトバウンドのインターネットアクセスが可能なVPCとサブネットが必要です。アウトバウンドインターネットにHTTPプロキシが必要な場合は、IPアドレス、クレデンシャル、HTTPS証明書が必要です。

[role="quick-margin-para"]
 up networking,ネットワーク要件を確認します。

[role="quick-margin-para"]
コネクタードロップダウンをクリックし、*コネクターの追加*を選択して、プロンプトに従います。

[role="quick-margin-para"]
 a Connector,ステップバイステップの手順に従います。



== AWS 認証をセットアップする

BlueXPでは、VPCにConnectorインスタンスを導入する前にAWSで認証する必要があります。次のいずれかの認証方式を選択できます。

* 必要な権限を持つIAMロールをBlueXPに割り当てます
* 必要な権限を持つIAMユーザにAWSアクセスキーとシークレットキーを指定します


どちらの方法でも、最初に、必要な権限を含むIAMポリシーを作成する必要があります。



=== IAMポリシーを作成します

このポリシーには、BlueXPからAWSでConnectorインスタンスを起動するために必要な権限のみが含まれています。このポリシーは、他の状況では使用しないでください。

BlueXPがコネクタを作成すると、コネクタインスタンスに新しい権限セットが適用され、コネクタがパブリッククラウド環境内のリソースを管理できるようになります。

.手順
. AWS IAMコンソールに移動します。
. [*Policies]>[Create policy*]をクリックします。
. [*JSON]をクリックします。
. 次のポリシーをコピーして貼り付けます。
+
[source, json]
----
{
    "Version": "2012-10-17",
    "Statement": [{
            "Effect": "Allow",
            "Action": [
                "iam:CreateRole",
                "iam:DeleteRole",
                "iam:PutRolePolicy",
                "iam:CreateInstanceProfile",
                "iam:DeleteRolePolicy",
                "iam:AddRoleToInstanceProfile",
                "iam:RemoveRoleFromInstanceProfile",
                "iam:DeleteInstanceProfile",
                "iam:PassRole",
                "ec2:DescribeInstanceStatus",
                "ec2:RunInstances",
                "ec2:ModifyInstanceAttribute",
                "ec2:CreateSecurityGroup",
                "ec2:DeleteSecurityGroup",
                "ec2:DescribeSecurityGroups",
                "ec2:RevokeSecurityGroupEgress",
                "ec2:AuthorizeSecurityGroupEgress",
                "ec2:AuthorizeSecurityGroupIngress",
                "ec2:RevokeSecurityGroupIngress",
                "ec2:CreateNetworkInterface",
                "ec2:DescribeNetworkInterfaces",
                "ec2:DeleteNetworkInterface",
                "ec2:ModifyNetworkInterfaceAttribute",
                "ec2:DescribeSubnets",
                "ec2:DescribeVpcs",
                "ec2:DescribeDhcpOptions",
                "ec2:DescribeKeyPairs",
                "ec2:DescribeRegions",
                "ec2:DescribeInstances",
                "ec2:CreateTags",
                "ec2:DescribeImages",
                "cloudformation:CreateStack",
                "cloudformation:DeleteStack",
                "cloudformation:DescribeStacks",
                "cloudformation:DescribeStackEvents",
                "cloudformation:ValidateTemplate",
                "ec2:AssociateIamInstanceProfile",
                "ec2:DescribeIamInstanceProfileAssociations",
                "ec2:DisassociateIamInstanceProfile",
                "iam:GetRole",
                "iam:TagRole",
                "iam:ListRoles",
                "kms:ListAliases"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "ec2:TerminateInstances"
            ],
            "Condition": {
                "StringLike": {
                    "ec2:ResourceTag/OCCMInstance": "*"
                }
            },
            "Resource": [
                "arn:aws:ec2:*:*:instance/*"
            ]
        }
    ]
}
----
. 必要に応じて、[次へ]をクリックしてタグを追加します。
. 「*次へ*」をクリックし、名前と概要 を入力します。
. ［*ポリシーの作成*］をクリックします。


このポリシーを、BlueXPが引き受けることができるIAMロールまたはIAMユーザに適用します。



=== IAM ロールを設定する

コネクタをAWSに展開するためにBlueXPが想定できるIAMロールを設定します。

.手順
. ターゲットアカウントの AWS IAM コンソールに移動します。
. [ アクセス管理 ] で、 [ 役割 ] 、 [ 役割の作成 *] の順にクリックし、手順に従って役割を作成します。
+
必ず次の手順を実行してください。

+
** 信頼されるエンティティのタイプ * で、 * AWS アカウント * を選択します。
** 別のAWSアカウント*を選択して、BlueXP SaaSアカウントのID 952013314444を入力します
** 前のセクションで作成したポリシーを選択します。


. ロールを作成したら、ロールARNをコピーして、コネクタの作成時にBlueXPに貼り付けることができます。


IAM ロールに必要な権限が割り当てられます。



=== IAM ユーザの権限を設定します

コネクタを作成するときに、 Connector インスタンスの導入に必要な権限を持つ IAM ユーザに AWS アクセスキーとシークレットキーを指定できます。

.手順
. AWS IAMコンソールで、* Users *をクリックしてユーザ名を選択します。
. [権限の追加]>[既存のポリシーを直接適用する*]をクリックします。
. 作成したポリシーを選択します。
. [*次へ*]をクリックし、[*権限の追加*]をクリックします。
. IAM ユーザのアクセスキーとシークレットキーにアクセスできることを確認します。


これで、AWSユーザにBlueXPからコネクタを作成するために必要な権限が付与されました。BlueXPによってプロンプトが表示されたら、このユーザのAWSアクセスキーを指定する必要があります。



== ネットワークをセットアップする

コネクタがパブリッククラウド環境内のリソースやプロセスを管理できるように、ネットワークを設定します。コネクタにVPCとサブネットを使用する以外に、次の要件が満たされていることを確認する必要があります。



=== ターゲットネットワークへの接続

コネクタには、作成する作業環境の種類と、有効にする予定のサービスへのネットワーク接続が必要です。

たとえば、会社のネットワークにコネクタをインストールした場合は、Cloud Volumes ONTAP を起動するVPCへのVPN接続を設定する必要があります。



=== アウトバウンドインターネットアクセス

Connector では、パブリッククラウド環境内のリソースとプロセスを管理するためにアウトバウンドインターネットアクセスが必要です。

[cols="2*"]
|===
| エンドポイント | 目的 


| \ https://support.netapp.com | ライセンス情報を取得し、ネットアップサポートに AutoSupport メッセージを送信するため。 


| ¥https://*.cloudmanager.cloud.netapp.com¥https://cloudmanager.cloud.netapp.com | BlueXPでSaaSの機能とサービスを提供するため。 


| ¥ https://cloudmanagerinfraprod.azurecr.io ¥ https://*.blob.core.windows.net | をクリックして、 Connector と Docker コンポーネントをアップグレードします。 
|===


=== プロキシサーバ

すべての送信インターネットトラフィックにHTTPプロキシを導入する必要がある場合は、HTTPプロキシに関する次の情報を取得します。

* IP アドレス
* クレデンシャル
* HTTPS証明書




=== セキュリティグループ

コネクタへの着信トラフィックは、コネクタを起動した場合や、コネクタがAutoSupport メッセージのプロキシとして使用されている場合を除き、受信トラフィックはありません。へのアクセスは、 HTTP および HTTPS を使用して提供されます link:concept-connectors.html#the-local-user-interface["ローカル UI"]は、まれな状況で使用します。SSH が必要になるのは、トラブルシューティングのためにホストに接続する必要がある場合のみです。



=== IPアドレスの制限

172の範囲のIPアドレスと競合する可能性があります。 link:reference-limitations.html["この制限事項の詳細については、こちらをご覧ください"]。



== コネクタを作成します

BlueXPでは、ユーザインターフェイスからAWSでコネクタを直接作成できます。

.手順
. 最初の作業環境を作成する場合は、 * 作業環境の追加 * をクリックし、プロンプトに従います。それ以外の場合は、 [*connector*] ドロップダウンをクリックし、 [*Add connector*] を選択します。
+
image:screenshot_connector_add.gif["ヘッダーのコネクターアイコンとコネクターの追加アクションを示すスクリーンショット。"]

. クラウドプロバイダとして「 * Amazon Web Services * 」を選択し、「 * Continue * 」をクリックします。
. [*コネクターの配置（Deploying a Connector *）]ページで、必要なものについて詳しく確認してください。次の 2 つのオプションがあります。
+
.. [* Continue *（続行）]をクリックして、製品ガイドを使用して導入の準備をします。製品ガイドの各手順には、このページのドキュメントに記載されている情報が含まれています。
.. このページの手順に従って準備が完了している場合は、*配備にスキップ*をクリックします。


. ウィザードの手順に従って、コネクタを作成します。
+
** * 準備をしてください * ：必要なものを確認してください。
** * AWSクレデンシャル*：AWSリージョンを指定してから認証方式を選択します。認証方式は、BlueXPが引き受けることができるIAMロールか、AWSのアクセスキーとシークレットキーのどちらかです。
+

TIP: [*Assume Role] を選択した場合は、 Connector 展開ウィザードから最初の資格情報セットを作成できます。クレデンシャルの追加のセットは、 [Credentials] ページから作成する必要があります。ウィザードのドロップダウンリストから使用できるようになります。 link:task-adding-aws-accounts.html["クレデンシャルを追加する方法について説明します"]。

** * 詳細 * ：コネクタの詳細を入力します。
+
*** インスタンスの名前を入力します。
*** カスタムタグ（メタデータ）をインスタンスに追加します。
*** 必要な権限を持つ新しいロールを作成するか、で設定した既存のロールを選択するかを選択します link:reference-permissions-aws.html["必要な権限"]。
*** コネクタの EBS ディスクを暗号化するかどうかを選択します。デフォルトの暗号化キーを使用することも、カスタムキーを使用することもできます。


** * ネットワーク * ：インスタンスに VPC 、サブネット、キーペアを指定し、パブリック IP アドレスを有効にするかどうかを選択し、必要に応じてプロキシ設定を指定します。
+
コネクタで使用する正しいキーペアがあることを確認します。キーペアがないと、Connector仮想マシンにアクセスできません。

** * セキュリティグループ * ：新しいセキュリティグループを作成するか、インバウンド HTTP 、 HTTPS 、 SSH アクセスを許可する既存のセキュリティグループを選択するかを選択します。
** * 復習 * ：選択内容を確認して、設定が正しいことを確認してください。


. [ 追加（ Add ） ] をクリックします。
+
インスタンスの準備が完了するまでに約 7 分かかります。処理が完了するまで、ページには表示されたままにしておいてください。



Connectorを作成したのと同じAWSアカウントにAmazon S3バケットがある場合、Amazon S3の作業環境がCanvasに自動的に表示されます。 link:task-viewing-amazon-s3.html["この作業環境でできることの詳細については、こちらをご覧ください"]。



== AutoSupport メッセージのポート3128を開きます

アウトバウンドインターネット接続が使用できないサブネットにCloud Volumes ONTAP システムを導入する場合、BlueXPは自動的にコネクタをプロキシサーバとして使用するようにCloud Volumes ONTAP を設定します。

唯一の要件は、コネクタのセキュリティグループがポート3128で_ inbound_connectionsを許可することです。コネクタを展開した後、このポートを開く必要があります。

Cloud Volumes ONTAP にデフォルトのセキュリティグループを使用する場合、そのセキュリティグループに対する変更は必要ありません。ただし、Cloud Volumes ONTAP に厳密なアウトバウンドルールを定義する場合は、Cloud Volumes ONTAP セキュリティグループがポート3128で_OUTBOUND接続を許可することも必要です。
