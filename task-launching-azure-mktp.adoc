---
sidebar: sidebar 
permalink: task-launching-azure-mktp.html 
keywords: install, installation, installing, marketplace, azure, deploy, virtual machine, permissions, deploy connector in azure, install connector in azure 
summary: Azureの商業地域では、BlueXPからコネクタを直接作成することをお勧めしますが、必要に応じてAzure Marketplaceからコネクタを起動することもできます。Azure Governmentリージョンでは、BlueXP SaaS Webサイトから政府機関のリージョンにConnectorを導入することはできないため、次の選択肢としてAzure Marketplaceから導入することをお勧めします。 
---
= Azure Marketplace からコネクタを作成します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Azureの商業地域では、BlueXPからコネクタを直接作成することをお勧めしますが、必要に応じてAzure Marketplaceからコネクタを起動することもできます。Azure Governmentリージョンでは、BlueXP SaaS Webサイトから政府機関のリージョンにConnectorを導入することはできないため、次の選択肢としてAzure Marketplaceから導入することをお勧めします。


TIP: ネットワーク内またはクラウド内の既存のLinuxホストにConnectorソフトウェアをダウンロードしてインストールすることもできます。 link:task-installing-linux.html["既存のLinuxホストにConnectorをインストールする方法について説明します"]。



== Azure でコネクタを作成する

Azure Marketplace のイメージを使用して Azure に Connector を導入し、コネクタにログインしてネットアップアカウントを指定します。

.手順
. Azure MarketplaceのNetApp Connector VMのページに移動します。
+
** https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["Azure Marketplaceの一般企業向けページ"^]
** https://portal.azure.us/#create/netapp.netapp-oncommand-cloud-manageroccm-byol["Azure GovernmentリージョンのAzure Marketplaceのページ"^]


. [* Get it Now* ( 今すぐ取得 )] をクリックし、 [* Continue * ( 続行 )] をクリックします。
. Azure ポータルで、 * Create * をクリックし、手順に従って仮想マシンを設定します。
+
VM を設定する際には、次の点に注意してください。

+
** コネクタはHDDディスクまたはSSDディスクで最適に動作します。
** CPU と RAM の要件を満たす VM サイズを選択します。DS3 v2 を推奨します。
+
link:task-installing-linux.html["VM の要件を確認します"]。

** ネットワークセキュリティグループの場合、コネクタには、 SSH 、 HTTP 、および HTTPS を使用したインバウンド接続が必要です。
+
link:reference-ports-azure.html["コネクタのセキュリティグループルールの詳細については、こちらを参照してください"]。

** [* 管理（ * Management ） ] で、 [ * オン * （ * on * ） ] を選択して、コネクターに割り当てられた管理 ID * を有効にします。
+
管理対象の ID を使用すると、 Connector 仮想マシンはクレデンシャルを指定せずに自身を Azure Active Directory に識別できるため、この設定は重要です。 https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["Azure リソース用の管理対象 ID の詳細については、こちらをご覧ください"^]。



. [* Review + create * （レビュー + 作成） ] ページで選択内容を確認し、 [* Create * （作成） ] をクリックして展開を開始します。
+
指定した設定で仮想マシンが展開されます。仮想マシンと Connector ソフトウェアが起動するまでの所要時間は約 5 分です。

. Connector 仮想マシンに接続されているホストから Web ブラウザを開き、次の URL を入力します。
+
https://_ipaddress_[]

. ログイン後、コネクタを設定します。
+
.. コネクタに関連付けるネットアップアカウントを指定します。
+
link:concept-netapp-accounts.html["ネットアップアカウントについて"]。

.. システムの名前を入力します。
+
image:screenshot_set_up_cloud_manager.gif["BlueXPのセットアップ画面のスクリーンショット。ネットアップアカウントを選択してシステムに名前を付けることができます。"]





これで、 Connector のインストールとセットアップが完了しました。

コネクタがAzureの商業地域にある場合は、Webブラウザを開き、に進みます https://console.bluexp.netapp.com[] BlueXPでコネクタの使用を開始します

コネクタがAzure Governmentリージョンにある場合は、Webブラウザを開いてコネクタインスタンスのIPアドレスに接続すると、BlueXPを使用できます。 https://_ipaddress_[]

コネクタは政府機関に導入されているため、からはアクセスできません https://console.bluexp.netapp.com[]。



== Azure 権限を付与しています

Azure にコネクタを導入したら、を有効にしておく必要があります https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["システムによって割り当てられた管理 ID"^]。カスタムロールを作成し、そのロールを Connector 仮想マシンに割り当てて、 1 つ以上のサブスクリプションに必要な Azure 権限を付与する必要があります。

.手順
. カスタムロールを作成します。
+
.. の内容をコピーします link:reference-permissions-azure.html["Connectorのカスタムロールの権限"] JSONファイルに保存します。
.. 割り当て可能なスコープに Azure サブスクリプション ID を追加して、 JSON ファイルを変更します。
+
ユーザが Cloud Volumes ONTAP システムを作成する Azure サブスクリプションごとに ID を追加する必要があります。

+
* 例 *

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
.. JSON ファイルを使用して、 Azure でカスタムロールを作成します。
+
次の手順は、 Azure Cloud Shell で Bash を使用してロールを作成する方法を示しています。

+
*** 開始 https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Azure Cloud Shell の略"^] Bash 環境を選択します。
*** JSON ファイルをアップロードします。
+
image:screenshot_azure_shell_upload.png["ファイルをアップロードするオプションを選択できる Azure Cloud Shell のスクリーンショット。"]

*** Azure CLI で次のコマンドを入力します。
+
[source, azurecli]
----
az role definition create --role-definition Policy_for_Setup_As_Service_Azure.json
----
+
これで、Connector仮想マシンに割り当てることができるBlueXP Operatorというカスタムロールが作成されました。





. 1 つ以上のサブスクリプションのロールを Connector 仮想マシンに割り当てます。
+
.. [ サブスクリプション ] サービスを開き、 Cloud Volumes ONTAP システムを展開するサブスクリプションを選択します。
.. * アクセス制御（ IAM ） * > * 追加 * > * 役割の割り当ての追加 * をクリックします。
.. [*役割]タブで、[* BlueXP演算子*]役割を選択し、[次へ]をクリックします。
+

NOTE: BlueXP Operatorは'BlueXPポリシーで指定されているデフォルト名ですロールに別の名前を選択した場合は、代わりにその名前を選択します。

.. [* Members* （メンバー * ） ] タブで、次の手順を実行します。
+
*** * 管理対象 ID * へのアクセス権を割り当てます。
*** [ * メンバーの選択 * ] をクリックし、 Connector 仮想マシンが作成されたサブスクリプションを選択し、 [ * 仮想マシン * ] を選択してから、 Connector 仮想マシンを選択します。
*** [ * 選択 * ] をクリックします。
*** 「 * 次へ * 」をクリックします。


.. [ レビュー + 割り当て（ Review + Assign ） ] をクリックします。
.. 追加のサブスクリプションから Cloud Volumes ONTAP を導入する場合は、そのサブスクリプションに切り替えてから、これらの手順を繰り返します。




Connector には、パブリッククラウド環境内のリソースとプロセスを管理するために必要な権限が付与されました。新しい作業環境を作成するときに、BlueXPではこのコネクタが自動的に使用されます。ただし、コネクタが複数ある場合は、が必要です link:task-managing-connectors.html["スイッチを切り替えます"]。

Connectorを作成したのと同じAzureアカウントにAzure BLOBストレージがある場合は、Azure Blob作業環境がCanvasに自動的に表示されます。 link:task-viewing-azure-blob.html["この作業環境でできることの詳細については、こちらをご覧ください"]。



== AutoSupport メッセージのポート3128を開きます

アウトバウンドインターネット接続が使用できないサブネットにCloud Volumes ONTAP システムを導入する場合、BlueXPは自動的にコネクタをプロキシサーバとして使用するようにCloud Volumes ONTAP を設定します。

唯一の要件は、コネクタのセキュリティグループがポート3128で_ inbound_connectionsを許可することです。コネクタを展開した後、このポートを開く必要があります。

Cloud Volumes ONTAP にデフォルトのセキュリティグループを使用する場合、そのセキュリティグループに対する変更は必要ありません。ただし、Cloud Volumes ONTAP に厳密なアウトバウンドルールを定義する場合は、Cloud Volumes ONTAP セキュリティグループがポート3128で_OUTBOUND接続を許可することも必要です。
