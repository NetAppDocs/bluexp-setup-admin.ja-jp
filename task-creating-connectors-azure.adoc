---
sidebar: sidebar 
permalink: task-creating-connectors-azure.html 
keywords: create connector in azure, launch connector in azure, deploy connector in azure, azure connector, connector azure, connector permissions, create custom role, create azure custom role, azure custom role 
summary: BlueXPのほとんどの機能を使用するには、コネクタを展開する必要があります。Connectorを使用すると、BlueXPはパブリッククラウド環境内のリソースとプロセスを管理できます。 
---
= BlueXPからAzureにコネクタを作成します
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
BlueXPのほとんどの機能を使用するには'BlueXPアカウント管理者が_Connector_を 配備する必要がありますConnectorを使用すると、BlueXPはパブリッククラウド環境内のリソースとプロセスを管理できます。 link:concept-connectors.html["コネクタが必要になるタイミングを学習します"]。

このページでは、BlueXPから直接Azureでコネクタを作成する方法について説明します。 link:concept-connectors.html#how-to-create-a-connector["コネクタを配置するその他の方法について説明します"]。

これらの手順は、 Account Admin ロールを持つユーザが実行する必要があります。ワークスペース管理者はコネクタを作成できません。



== 概要

Connectorを導入するには、AzureでConnector VMを作成するために必要な権限を持つログインをBlueXPに提供する必要があります。

次の 2 つのオプションがあります。

. プロンプトが表示されたら、 Microsoft アカウントでサインインします。このアカウントには Azure 固有の権限が必要です。これがデフォルトのオプションです。
+
<<Azure アカウントを使用してコネクタを作成します,次の手順に従って、作業を開始してください>>。

. Azure AD サービスプリンシパルの詳細を指定します。このサービスプリンシパルには、特定の権限も必要です。
+
<<サービスプリンシパルを使用してコネクタを作成します,次の手順に従って、作業を開始してください>>。





== Azureリージョンに関するメモ

コネクタは、管理対象の Cloud Volumes ONTAP システムまたはにある Azure リージョンと同じ Azure リージョンに導入する必要があります https://docs.microsoft.com/en-us/azure/availability-zones/cross-region-replication-azure#azure-cross-region-replication-pairings-for-all-geographies["Azure リージョンペア"^] Cloud Volumes ONTAP システム用。この要件により、 Cloud Volumes ONTAP とそれに関連付けられたストレージアカウント間で Azure Private Link 接続が使用されるようになります。

https://docs.netapp.com/us-en/cloud-manager-cloud-volumes-ontap/task-enabling-private-link.html["Cloud Volumes ONTAP での Azure プライベートリンクの使用方法をご確認ください"^]



== ネットワークをセットアップする

コネクタがパブリッククラウド環境内のリソースやプロセスを管理できるように、ネットワークを設定します。コネクタ用のVNetとサブネットを使用する以外にも、次の要件が満たされていることを確認する必要があります。



=== ターゲットネットワークへの接続

コネクタには、作成する作業環境の種類と、有効にする予定のサービスへのネットワーク接続が必要です。

たとえば、企業ネットワークにコネクタを取り付ける場合は、Cloud Volumes ONTAP を起動するVNetへのVPN接続を設定する必要があります。



=== アウトバウンドインターネットアクセス

Connector では、パブリッククラウド環境内のリソースとプロセスを管理するためにアウトバウンドインターネットアクセスが必要です。

[cols="2*"]
|===
| エンドポイント | 目的 


| \ https://support.netapp.com | ライセンス情報を取得し、ネットアップサポートに AutoSupport メッセージを送信するため。 


 a| 
\ https://*.api.bluexp.netapp.com

\ https://api.bluexp.netapp.com

\ https://*.cloudmanager.cloud.netapp.com

\ https://cloudmanager.cloud.netapp.com
 a| 
BlueXPでSaaSの機能とサービスを提供するため。


NOTE: コネクターは現在、「cloudmanager.cloud.netapp.com"」に接続していますが、今後のリリースでapi.bluexp.netapp.com"への連絡を開始します。



| ¥ https://cloudmanagerinfraprod.azurecr.io ¥ https://*.blob.core.windows.net | をクリックして、 Connector と Docker コンポーネントをアップグレードします。 
|===


=== プロキシサーバ

すべての送信インターネットトラフィックにHTTPプロキシを導入する必要がある場合は、HTTPプロキシに関する次の情報を取得します。

* IP アドレス
* クレデンシャル
* HTTPS証明書




=== セキュリティグループ

コネクタへの着信トラフィックは、コネクタを起動した場合や、コネクタがAutoSupport メッセージのプロキシとして使用されている場合を除き、受信トラフィックはありません。へのアクセスは、 HTTP および HTTPS を使用して提供されます link:concept-connectors.html#the-local-user-interface["ローカル UI"]は、まれな状況で使用します。SSH が必要になるのは、トラブルシューティングのためにホストに接続する必要がある場合のみです。



=== IPアドレスの制限

172の範囲のIPアドレスと競合する可能性があります。 link:reference-limitations.html["この制限事項の詳細については、こちらをご覧ください"]。



== Azure アカウントを使用してコネクタを作成します

Azure でコネクタを作成するデフォルトの方法は、プロンプトが表示されたら Azure アカウントでログインすることです。ログインフォームは、 Microsoft が所有およびホストしています。クレデンシャルがネットアップに提供されていません。



=== Azure アカウントの権限を設定します

BlueXPからConnectorを導入する前に、Azureアカウントに正しい権限があることを確認する必要があります。

.手順
. Azureの新しいカスタムロールに必要な権限をコピーし、JSONファイルに保存します。
+

NOTE: このポリシーには、BlueXPからAzureでConnector VMを起動するために必要な権限のみが含まれています。このポリシーは、他の状況では使用しないでください。BlueXPがコネクタを作成すると、Connector VMに新しい権限セットが適用され、Connectorがパブリッククラウド環境内のリソースを管理できるようになります。

+
[source, json]
----
{
    "Name": "Azure SetupAsService",
    "Actions": [
        "Microsoft.Compute/disks/delete",
        "Microsoft.Compute/disks/read",
        "Microsoft.Compute/disks/write",
        "Microsoft.Compute/locations/operations/read",
        "Microsoft.Compute/operations/read",
        "Microsoft.Compute/virtualMachines/instanceView/read",
        "Microsoft.Compute/virtualMachines/read",
        "Microsoft.Compute/virtualMachines/write",
        "Microsoft.Compute/virtualMachines/delete",
        "Microsoft.Compute/virtualMachines/extensions/write",
        "Microsoft.Compute/virtualMachines/extensions/read",
        "Microsoft.Compute/availabilitySets/read",
        "Microsoft.Network/locations/operationResults/read",
        "Microsoft.Network/locations/operations/read",
        "Microsoft.Network/networkInterfaces/join/action",
        "Microsoft.Network/networkInterfaces/read",
        "Microsoft.Network/networkInterfaces/write",
        "Microsoft.Network/networkInterfaces/delete",
        "Microsoft.Network/networkSecurityGroups/join/action",
        "Microsoft.Network/networkSecurityGroups/read",
        "Microsoft.Network/networkSecurityGroups/write",
        "Microsoft.Network/virtualNetworks/checkIpAddressAvailability/read",
        "Microsoft.Network/virtualNetworks/read",
        "Microsoft.Network/virtualNetworks/subnets/join/action",
        "Microsoft.Network/virtualNetworks/subnets/read",
        "Microsoft.Network/virtualNetworks/subnets/virtualMachines/read",
        "Microsoft.Network/virtualNetworks/virtualMachines/read",
        "Microsoft.Network/publicIPAddresses/write",
        "Microsoft.Network/publicIPAddresses/read",
        "Microsoft.Network/publicIPAddresses/delete",
        "Microsoft.Network/networkSecurityGroups/securityRules/read",
        "Microsoft.Network/networkSecurityGroups/securityRules/write",
        "Microsoft.Network/networkSecurityGroups/securityRules/delete",
        "Microsoft.Network/publicIPAddresses/join/action",
        "Microsoft.Network/locations/virtualNetworkAvailableEndpointServices/read",
        "Microsoft.Network/networkInterfaces/ipConfigurations/read",
        "Microsoft.Resources/deployments/operations/read",
        "Microsoft.Resources/deployments/read",
        "Microsoft.Resources/deployments/delete",
        "Microsoft.Resources/deployments/cancel/action",
        "Microsoft.Resources/deployments/validate/action",
        "Microsoft.Resources/resources/read",
        "Microsoft.Resources/subscriptions/operationresults/read",
        "Microsoft.Resources/subscriptions/resourceGroups/delete",
        "Microsoft.Resources/subscriptions/resourceGroups/read",
        "Microsoft.Resources/subscriptions/resourcegroups/resources/read",
        "Microsoft.Resources/subscriptions/resourceGroups/write",
        "Microsoft.Authorization/roleDefinitions/write",
        "Microsoft.Authorization/roleAssignments/write",
        "Microsoft.MarketplaceOrdering/offertypes/publishers/offers/plans/agreements/read",
        "Microsoft.MarketplaceOrdering/offertypes/publishers/offers/plans/agreements/write",
        "Microsoft.Network/networkSecurityGroups/delete",
        "Microsoft.Storage/storageAccounts/delete",
        "Microsoft.Storage/storageAccounts/write",
        "Microsoft.Resources/deployments/write",
        "Microsoft.Resources/deployments/operationStatuses/read",
        "Microsoft.Authorization/roleAssignments/read"
    ],
    "NotActions": [],
    "AssignableScopes": [],
    "Description": "Azure SetupAsService",
    "IsCustom": "true"
}
----
. JSONを変更して、割り当て可能な範囲にAzureサブスクリプションIDを追加します。
+
* 例 *

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz"
],
----
. JSON ファイルを使用して、 Azure でカスタムロールを作成します。
+
次の手順は、 Azure Cloud Shell で Bash を使用してロールを作成する方法を示しています。

+
.. 開始 https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Azure Cloud Shell の略"^] Bash 環境を選択します。
.. JSON ファイルをアップロードします。
+
image:screenshot_azure_shell_upload.png["ファイルをアップロードするオプションを選択できる Azure Cloud Shell のスクリーンショット。"]

.. Azure CLI で次のコマンドを入力します。
+
[source, azurecli]
----
az role definition create --role-definition Policy_for_Setup_As_Service_Azure.json
----


+
これで、 _Azure SetupAsService_という カスタムロールが作成されました。

. BlueXPからコネクタを配備するユーザーにロールを割り当てます
+
.. [ サブスクリプション ] サービスを開き、ユーザーのサブスクリプションを選択します。
.. 「 * アクセスコントロール（ IAM ） * 」をクリックします。
.. [ * 追加 *>* 役割の割り当ての追加 * ] をクリックして、権限を追加します。
+
*** Azure SetupAsService * ロールを選択し、 * 次へ * をクリックします。
+

NOTE: Azure SetupAsServiceは、Azureのコネクタ導入ポリシーで指定されているデフォルトの名前です。ロールに別の名前を選択した場合は、代わりにその名前を選択します。

*** [* ユーザー、グループ、またはサービスプリンシパル * ] を選択したままにします。
*** [ * メンバーの選択 * ] をクリックし、ユーザーアカウントを選択して、 [ * 選択 * ] をクリックします。
*** 「 * 次へ * 」をクリックします。
*** [ レビュー + 割り当て（ Review + Assign ） ] をクリックします。






.結果
これで、Azureユーザには、BlueXPからConnectorを導入するために必要な権限が付与されました。



=== Azure アカウントでログインしてコネクタを作成します

BlueXPを使用すると、Azureでユーザーインターフェイスからコネクタを直接作成できます。

.必要なもの
* Azure サブスクリプション。
* 選択した Azure リージョン内の VNet およびサブネット
* BlueXPでコネクタ用のAzureロールを自動的に作成しない場合は、自分で作成する必要があります link:reference-permissions-azure.html["このページのポリシーを使用する"]。
+
これらの権限はコネクタインスタンス自体に適用されます。これは、以前にコネクタを展開するように設定したアクセス権とは異なります。



.手順
. 最初の作業環境を作成する場合は、 * 作業環境の追加 * をクリックし、プロンプトに従います。それ以外の場合は、 [*connector*] ドロップダウンをクリックし、 [*Add connector*] を選択します。
+
image:screenshot_connector_add.gif["ヘッダーのコネクターアイコンとコネクターの追加アクションを示すスクリーンショット。"]

. クラウドプロバイダとして「 * Microsoft Azure * 」を選択します。
. [*コネクターの配置（Deploying a Connector *）]ページで、必要なものについて詳しく確認してください。次の 2 つのオプションがあります。
+
.. [* Continue *（続行）]をクリックして、製品ガイドを使用して導入の準備をします。各手順には、このページのドキュメントに記載されている情報が含まれています。
.. このページの手順に従って準備が完了している場合は、*配備にスキップ*をクリックします。


. ウィザードの手順に従って、コネクタを作成します。
+
** プロンプトが表示されたら、 Microsoft アカウントにログインします。このアカウントには、仮想マシンの作成に必要な権限が付与されている必要があります。
+
このフォームは、 Microsoft が所有およびホストしています。クレデンシャルがネットアップに提供されていません。

+

TIP: すでにAzureアカウントにログインしている場合は、BlueXPによって自動的にそのアカウントが使用されます。アカウントが複数ある場合は、適切なアカウントを使用するために、最初にログアウトする必要があります。

** * VM 認証 * ： Azure サブスクリプション、場所、新しいリソースグループ、または既存のリソースグループを選択し、認証方法を選択します。
** *詳細*:インスタンスの名前を入力し、タグを指定して、必要な権限を持つ新しいロールを作成するか、またはで設定した既存のロールを選択するかを選択します link:reference-permissions-azure.html["必要な権限"]。
+
このロールに関連付けられているサブスクリプションを選択できます。選択した各サブスクリプションには、 Cloud Volumes ONTAP をこれらのサブスクリプションに導入するための権限が Connector に付与されます。

** * ネットワーク * ： VNet とサブネットを選択し、パブリック IP アドレスを有効にするかどうか、および必要に応じてプロキシ設定を指定します。
** * セキュリティグループ * ：新しいセキュリティグループを作成するか、インバウンド HTTP 、 HTTPS 、 SSH アクセスを許可する既存のセキュリティグループを選択するかを選択します。
** * 復習 * ：選択内容を確認して、設定が正しいことを確認してください。


. [ 追加（ Add ） ] をクリックします。
+
仮想マシンの準備が完了するまでに約 7 分かかります。処理が完了するまで、ページには表示されたままにしておいてください。



.完了後
ワークスペース管理者がコネクタを使用して Cloud Volumes ONTAP システムを作成できるように、コネクタをワークスペースに関連付ける必要があります。アカウント管理者のみがいる場合は、コネクタをワークスペースに関連付ける必要はありません。アカウント管理者は、既定でBlueXPのすべてのワークスペースにアクセスできます。 link:task-setting-up-netapp-accounts.html#associating-connectors-with-workspaces["詳細はこちら。"]。

Connectorを作成したのと同じAzureアカウントにAzure BLOBストレージがある場合は、Azure Blob作業環境がCanvasに自動的に表示されます。 link:task-viewing-azure-blob.html["この作業環境でできることの詳細については、こちらをご覧ください"]。



== サービスプリンシパルを使用してコネクタを作成します

Azureアカウントでログインする代わりに、必要な権限を持つAzureサービスプリンシパルのクレデンシャルをBlueXPに提供することもできます。



=== サービスプリンシパルを使用した Azure 権限の付与

Azure Active Directoryでサービスプリンシパルを作成およびセットアップし、BlueXPで必要なAzureクレデンシャルを取得することで、AzureにConnectorを導入するために必要な権限を付与します。

.手順
. <<Azure Active Directory アプリケーションを作成します>>。
. <<アプリケーションをロールに割り当てます>>。
. <<Windows Azure Service Management API 権限を追加します>>。
. <<アプリケーション ID とディレクトリ ID を取得します>>。
. <<クライアントシークレットを作成します>>。




==== Azure Active Directory アプリケーションを作成します

BlueXPでConnectorの導入に使用できるAzure Active Directory（AD）アプリケーションとサービスプリンシパルを作成します。

.作業を開始する前に
Azure で Active Directory アプリケーションを作成してロールに割り当てるための適切な権限が必要です。詳細については、を参照してください https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions/["Microsoft Azure のドキュメント：「 Required permissions"^]。

.手順
. Azure ポータルで、 * Azure Active Directory * サービスを開きます。
+
image:screenshot_azure_ad.gif["は、 Microsoft Azure の Active Directory サービスを示しています。"]

. メニューで、 * アプリ登録 * をクリックします。
. [ 新規登録 ] をクリックします。
. アプリケーションの詳細を指定します。
+
** * 名前 * ：アプリケーションの名前を入力します。
** *アカウントの種類*:アカウントの種類を選択します(すべてのアカウントはBlueXPで動作します)。
** * リダイレクト URI *: このフィールドは空白のままにできます。


. [*Register] をクリックします。


.結果
AD アプリケーションとサービスプリンシパルを作成しておきます。



==== アプリケーションをロールに割り当てます

コネクタを導入する Azure サブスクリプションにサービスプリンシパルをバインドし、カスタムの「 Azure SetupAsService 」ロールを割り当てる必要があります。

.手順
. Azureの新しいカスタムロールに必要な権限をコピーし、JSONファイルに保存します。
+

NOTE: このポリシーには、BlueXPからAzureでConnector VMを起動するために必要な権限のみが含まれています。このポリシーは、他の状況では使用しないでください。BlueXPがコネクタを作成すると、Connector VMに新しい権限セットが適用され、Connectorがパブリッククラウド環境内のリソースを管理できるようになります。

+
[source, json]
----
{
    "Name": "Azure SetupAsService",
    "Actions": [
        "Microsoft.Compute/disks/delete",
        "Microsoft.Compute/disks/read",
        "Microsoft.Compute/disks/write",
        "Microsoft.Compute/locations/operations/read",
        "Microsoft.Compute/operations/read",
        "Microsoft.Compute/virtualMachines/instanceView/read",
        "Microsoft.Compute/virtualMachines/read",
        "Microsoft.Compute/virtualMachines/write",
        "Microsoft.Compute/virtualMachines/delete",
        "Microsoft.Compute/virtualMachines/extensions/write",
        "Microsoft.Compute/virtualMachines/extensions/read",
        "Microsoft.Compute/availabilitySets/read",
        "Microsoft.Network/locations/operationResults/read",
        "Microsoft.Network/locations/operations/read",
        "Microsoft.Network/networkInterfaces/join/action",
        "Microsoft.Network/networkInterfaces/read",
        "Microsoft.Network/networkInterfaces/write",
        "Microsoft.Network/networkInterfaces/delete",
        "Microsoft.Network/networkSecurityGroups/join/action",
        "Microsoft.Network/networkSecurityGroups/read",
        "Microsoft.Network/networkSecurityGroups/write",
        "Microsoft.Network/virtualNetworks/checkIpAddressAvailability/read",
        "Microsoft.Network/virtualNetworks/read",
        "Microsoft.Network/virtualNetworks/subnets/join/action",
        "Microsoft.Network/virtualNetworks/subnets/read",
        "Microsoft.Network/virtualNetworks/subnets/virtualMachines/read",
        "Microsoft.Network/virtualNetworks/virtualMachines/read",
        "Microsoft.Network/publicIPAddresses/write",
        "Microsoft.Network/publicIPAddresses/read",
        "Microsoft.Network/publicIPAddresses/delete",
        "Microsoft.Network/networkSecurityGroups/securityRules/read",
        "Microsoft.Network/networkSecurityGroups/securityRules/write",
        "Microsoft.Network/networkSecurityGroups/securityRules/delete",
        "Microsoft.Network/publicIPAddresses/join/action",
        "Microsoft.Network/locations/virtualNetworkAvailableEndpointServices/read",
        "Microsoft.Network/networkInterfaces/ipConfigurations/read",
        "Microsoft.Resources/deployments/operations/read",
        "Microsoft.Resources/deployments/read",
        "Microsoft.Resources/deployments/delete",
        "Microsoft.Resources/deployments/cancel/action",
        "Microsoft.Resources/deployments/validate/action",
        "Microsoft.Resources/resources/read",
        "Microsoft.Resources/subscriptions/operationresults/read",
        "Microsoft.Resources/subscriptions/resourceGroups/delete",
        "Microsoft.Resources/subscriptions/resourceGroups/read",
        "Microsoft.Resources/subscriptions/resourcegroups/resources/read",
        "Microsoft.Resources/subscriptions/resourceGroups/write",
        "Microsoft.Authorization/roleDefinitions/write",
        "Microsoft.Authorization/roleAssignments/write",
        "Microsoft.MarketplaceOrdering/offertypes/publishers/offers/plans/agreements/read",
        "Microsoft.MarketplaceOrdering/offertypes/publishers/offers/plans/agreements/write",
        "Microsoft.Network/networkSecurityGroups/delete",
        "Microsoft.Storage/storageAccounts/delete",
        "Microsoft.Storage/storageAccounts/write",
        "Microsoft.Resources/deployments/write",
        "Microsoft.Resources/deployments/operationStatuses/read",
        "Microsoft.Authorization/roleAssignments/read"
    ],
    "NotActions": [],
    "AssignableScopes": [],
    "Description": "Azure SetupAsService",
    "IsCustom": "true"
}
----
. JSON ファイルを変更して、割り当て可能な範囲に Azure サブスクリプション ID を追加します。
+
* 例 *

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
. JSON ファイルを使用して、 Azure でカスタムロールを作成します。
+
次の手順は、 Azure Cloud Shell で Bash を使用してロールを作成する方法を示しています。

+
.. 開始 https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Azure Cloud Shell の略"^] Bash 環境を選択します。
.. JSON ファイルをアップロードします。
+
image:screenshot_azure_shell_upload.png["ファイルをアップロードするオプションを選択できる Azure Cloud Shell のスクリーンショット。"]

.. Azure CLI で次のコマンドを入力します。
+
[source, azurecli]
----
az role definition create --role-definition Policy_for_Setup_As_Service_Azure.json
----


+
これで、 _Azure SetupAsService_という カスタムロールが作成されました。

. ロールにアプリケーションを割り当てます。
+
.. Azure ポータルで、 * Subscriptions * サービスを開きます。
.. サブスクリプションを選択します。
.. [* アクセス制御 (IAM)] 、 [ 追加 ] 、 [ 役割の割り当ての追加 *] の順にクリックします。
.. [* 役割（ * Role ） ] タブで、 * Azure SetupAsService * 役割を選択し、 * 次へ * をクリックします。
.. [* Members* （メンバー * ） ] タブで、次の手順を実行します。
+
*** [* ユーザー、グループ、またはサービスプリンシパル * ] を選択したままにします。
*** [ メンバーの選択 ] をクリックします。
+
image:screenshot-azure-service-principal-role.png["アプリケーションにロールを追加するときに Members タブを表示する Azure ポータルのスクリーンショット。"]

*** アプリケーションの名前を検索します。
+
次に例を示します。

+
image:screenshot_azure_service_principal_role.png["Azure ポータルのスクリーンショットで、 Azure ポータルのロール割り当ての追加フォームが表示されています。"]

*** アプリケーションを選択し、 * Select * をクリックします。
*** 「 * 次へ * 」をクリックします。


.. [ レビュー + 割り当て（ Review + Assign ） ] をクリックします。
+
サービスプリンシパルに、 Connector の導入に必要な Azure 権限が付与されるようになりました。







==== Windows Azure Service Management API 権限を追加します

サービスプリンシパルに「 Windows Azure Service Management API 」の権限が必要です。

.手順
. Azure Active Directory * サービスで、 * アプリ登録 * をクリックしてアプリケーションを選択します。
. [API アクセス許可 ] 、 [ アクセス許可の追加 ] の順にクリックします。
. Microsoft API* で、 * Azure Service Management * を選択します。
+
image:screenshot_azure_service_mgmt_apis.gif["Azure Service Management API 権限を示す Azure ポータルのスクリーンショット。"]

. [* 組織ユーザーとして Azure サービス管理にアクセスする *] をクリックし、 [ * 権限の追加 * ] をクリックします。
+
image:screenshot_azure_service_mgmt_apis_add.gif["Azure Service Management API の追加を示す Azure ポータルのスクリーンショット。"]





==== アプリケーション ID とディレクトリ ID を取得します

BlueXPからコネクタを作成するときは'アプリケーション(クライアント) IDとディレクトリ(テナント) IDを指定する必要がありますBlueXPでは、プログラムでサインインするためにIDが使用されます。

.手順
. Azure Active Directory * サービスで、 * アプリ登録 * をクリックしてアプリケーションを選択します。
. アプリケーション（クライアント） ID * とディレクトリ（テナント） ID * をコピーします。
+
image:screenshot_azure_app_ids.gif["Azure Active Directory 内のアプリケーション（クライアント）の ID とディレクトリ（テナント） ID を示すスクリーンショット。"]





==== クライアントシークレットを作成します

クライアントシークレットを作成し、BlueXPがこれを使用してAzure ADで認証できるようにシークレットの値をBlueXPに提供する必要があります。

.手順
. Azure Active Directory * サービスを開きます。
. [* アプリ登録 * ] をクリックして、アプリケーションを選択します。
. ［ * 証明書とシークレット > 新しいクライアントシークレット * ］ をクリックします。
. シークレットと期間の説明を入力します。
. [ 追加（ Add ） ] をクリックします。
. クライアントシークレットの値をコピーします。
+
image:screenshot_azure_client_secret.gif["Azure AD サービスプリンシパルのクライアントシークレットを表示する Azure ポータルのスクリーンショット。"]



.結果
これでサービスプリンシパルが設定され、アプリケーション（クライアント） ID 、ディレクトリ（テナント） ID 、およびクライアントシークレットの値をコピーしました。コネクタを作成するときに、BlueXPでこの情報を入力する必要があります。



=== サービスプリンシパルでログインしてコネクタを作成します

BlueXPを使用すると、Azureでユーザーインターフェイスからコネクタを直接作成できます。

.必要なもの
* Azure サブスクリプション。
* 選択した Azure リージョン内の VNet およびサブネット
* すべての発信インターネットトラフィックにプロキシを必要とする場合は、HTTPプロキシに関する詳細情報を参照してください。
+
** IP アドレス
** クレデンシャル
** HTTPS証明書


* BlueXPでコネクタ用のAzureロールを自動的に作成しない場合は、自分で作成する必要があります link:reference-permissions-azure.html["このページのポリシーを使用する"]。
+
これらの権限はコネクタインスタンス自体に適用されます。これは、以前にコネクタを展開するように設定したアクセス権とは異なります。



.手順
. 最初の作業環境を作成する場合は、 * 作業環境の追加 * をクリックし、プロンプトに従います。それ以外の場合は、 [*connector*] ドロップダウンをクリックし、 [*Add connector*] を選択します。
+
image:screenshot_connector_add.gif["ヘッダーのコネクターアイコンとコネクターの追加アクションを示すスクリーンショット。"]

. クラウドプロバイダとして「 * Microsoft Azure * 」を選択します。
. [*コネクターの配置（Deploying a Connector *）]ページ：
+
.. [*認証]で、[* Active Directoryサービスプリンシパル*]をクリックし、必要な権限を付与するAzure Active Directoryサービスプリンシパルに関する情報を入力します。
+
*** アプリケーション（クライアント） ID ：を参照してください <<アプリケーション ID とディレクトリ ID を取得します>>。
*** ディレクトリ（テナント） ID ：を参照してください <<アプリケーション ID とディレクトリ ID を取得します>>。
*** クライアントシークレット：を参照してください <<クライアントシークレットを作成します>>。


.. *ログイン*をクリックします。
.. 次の2つのオプションがあります。
+
*** [* Continue *（続行）]をクリックして、製品ガイドを使用して導入の準備をします。製品ガイドの各手順には、このページのドキュメントに記載されている情報が含まれています。
*** このページの手順に従って準備が完了している場合は、*配備にスキップ*をクリックします。




. ウィザードの手順に従って、コネクタを作成します。
+
** * VM 認証 * ： Azure サブスクリプション、場所、新しいリソースグループ、または既存のリソースグループを選択し、認証方法を選択します。
** *詳細*:インスタンスの名前を入力し、タグを指定して、必要な権限を持つ新しいロールを作成するか、またはで設定した既存のロールを選択するかを選択します link:reference-permissions-azure.html["必要な権限"]。
+
このロールに関連付けられているサブスクリプションを選択できます。選択した各サブスクリプションには、 Cloud Volumes ONTAP をこれらのサブスクリプションに導入するための権限が Connector に付与されます。

** * ネットワーク * ： VNet とサブネットを選択し、パブリック IP アドレスを有効にするかどうか、および必要に応じてプロキシ設定を指定します。
** * セキュリティグループ * ：新しいセキュリティグループを作成するか、インバウンド HTTP 、 HTTPS 、 SSH アクセスを許可する既存のセキュリティグループを選択するかを選択します。
** * 復習 * ：選択内容を確認して、設定が正しいことを確認してください。


. [ 追加（ Add ） ] をクリックします。
+
仮想マシンの準備が完了するまでに約 7 分かかります。処理が完了するまで、ページには表示されたままにしておいてください。



.完了後
ワークスペース管理者がコネクタを使用して Cloud Volumes ONTAP システムを作成できるように、コネクタをワークスペースに関連付ける必要があります。アカウント管理者のみがいる場合は、コネクタをワークスペースに関連付ける必要はありません。アカウント管理者は、既定でBlueXPのすべてのワークスペースにアクセスできます。 link:task-setting-up-netapp-accounts.html#associating-connectors-with-workspaces["詳細はこちら。"]。

Connectorを作成したのと同じAzureアカウントにAzure BLOBストレージがある場合は、Azure Blob作業環境がCanvasに自動的に表示されます。 link:task-viewing-azure-blob.html["この作業環境でできることの詳細については、こちらをご覧ください"]。



== AutoSupport メッセージのポート3128を開きます

アウトバウンドインターネット接続が使用できないサブネットにCloud Volumes ONTAP システムを導入する場合、BlueXPは自動的にコネクタをプロキシサーバとして使用するようにCloud Volumes ONTAP を設定します。

唯一の要件は、コネクタのセキュリティグループがポート3128で_ inbound_connectionsを許可することです。コネクタを展開した後、このポートを開く必要があります。

Cloud Volumes ONTAP にデフォルトのセキュリティグループを使用する場合、そのセキュリティグループに対する変更は必要ありません。ただし、Cloud Volumes ONTAP に厳密なアウトバウンドルールを定義する場合は、Cloud Volumes ONTAP セキュリティグループがポート3128で_OUTBOUND接続を許可することも必要です。
